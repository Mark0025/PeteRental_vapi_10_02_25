# Claude Agent Discovery Guide - PeteRental VAPI Edition

## Purpose

This guide teaches another Claude agent how to discover and understand the configuration, methodology, and history of how Claude has helped progress this Python-based FastAPI codebase.

## Project Context

**PeteRental VAPI** is a FastAPI-based rental property search and scraping service integrating with VAPI (Voice AI Platform). Unlike typical Next.js projects, this is a Python backend using:
- FastAPI for API endpoints
- LangChain + OpenRouter for AI-powered scraping
- Playwright for browser automation
- JSON-based database for caching
- Docker for containerization
- Render for deployment

## Discovery Steps

### 1. Read the Project Instructions First

**ALWAYS START HERE:**
```bash
# Read project-specific Claude instructions
cat CLAUDE.md
```

This file contains:
- Complete architecture overview
- Development commands
- Deployment instructions
- API endpoint documentation
- Testing strategies
- Implementation details

### 2. Explore the DEV_MAN Documentation Center

The `DEV_MAN/` directory is the **source of truth** for all planning, architecture, and troubleshooting:

```bash
# View documentation index
cat DEV_MAN/README.md

# Key documents:
cat DEV_MAN/ARCHITECTURE.md           # System architecture & request flow
cat DEV_MAN/BEHAVIOR_ANALYSIS.md      # Issue analysis & root causes
cat DEV_MAN/DEPLOYMENT_PIPELINE.md    # Docker + Render deployment
cat DEV_MAN/system_overview.md        # Original system documentation
cat DEV_MAN/troubleshooting.md        # Common issues & solutions
```

**Pattern Observed**: Each feature/issue gets documented in multiple formats:
1. **APP_PLAN.md** - Detailed implementation plan with code examples
2. **ASKI.md** - ASCII art diagrams and flow charts
3. **MERMAID.md** - Mermaid diagrams for visual representation
4. **ARCHITECTURE.md** - Core architecture documentation

Example: Calendar Integration
- `CALENDAR_INTEGRATION_APP_PLAN.md` (25KB detailed plan)
- `CALENDAR_INTEGRATION_ASKI.md` (7.8KB flow diagrams)
- `CALENDAR_INTEGRATION_MERMAID.md` (11KB mermaid charts)

### 3. Understand the GitHub-as-Source-of-Truth Workflow

**Repository**: https://github.com/Mark0025/PeteRental_vapi_10_02_25

**Workflow Discovered**:
1. **Issue Creation** - Claude creates GitHub issues for planned work using `gh` CLI
2. **Planning in DEV_MAN** - Detailed plans stored in DEV_MAN directory
3. **Implementation** - Code changes tracked via git commits
4. **Documentation** - Issues and plans kept synchronized
5. **Deployment** - Auto-deploy via git push to main

```bash
# Check for GitHub issues
gh issue list

# View recent commits
git log --oneline -20

# Check deployment status
git remote -v
```

### 4. Trace the Development Methodology

**The Pattern**:
```
1. User Request
   ‚Üì
2. Create Issue in GitHub (gh issue create)
   ‚Üì
3. Document Plan in DEV_MAN/
   - APP_PLAN: Implementation details
   - ASKI: Flow diagrams
   - MERMAID: Visual architecture
   ‚Üì
4. Implement Changes
   - Update code files
   - Add tests
   - Update CLAUDE.md if needed
   ‚Üì
5. Commit & Deploy
   - git commit with descriptive message
   - git push origin main
   - Auto-deploy to Render
   ‚Üì
6. Update Issue Status
   - Link commits to issues
   - Close when complete
```

### 5. Discover Configuration Patterns

**Environment Setup**:
```bash
# Dependencies managed by uv (not npm)
cat pyproject.toml
cat uv.lock

# Environment variables
cat .env.example

# Docker configuration
cat Dockerfile
cat docker-compose.yml

# Deployment config
cat render.yaml
```

**Key Files**:
- `main.py` - FastAPI application entry point
- `rental_database.py` - JSON database operations
- `rental_data.json` - Cached rental properties
- `langchain_rental_scraper.py` - AI-powered scraper
- `playwright_scraper.py` - Browser automation

### 6. Find Tool Usage Patterns

**Python Tools** (not Node.js):
```bash
# Package management
uv sync                    # Install dependencies (replaces npm install)
uv add <package>          # Add package (replaces npm install <pkg>)

# Running the app
uv run uvicorn main:app --reload    # Start dev server
uv run python rental_database.py   # Test database
uv run pytest                       # Run tests

# Docker
docker build -t mark0025/peterentalvapi:latest .
docker push mark0025/peterentalvapi:latest

# GitHub CLI
gh issue list
gh issue create --title "..." --body "..."
gh pr create

# Deployment
git push origin main       # Auto-deploys to Render
```

### 7. Understand the Planning Workflow

**Step 1: Create Detailed Plan**
```markdown
# Example: DEV_MAN/CALENDAR_INTEGRATION_APP_PLAN.md
- Dependencies to add
- File structure
- Implementation details with code examples
- Testing strategy
- Success criteria
- Deployment checklist
```

**Step 2: Create Visual Documentation**
```markdown
# Example: DEV_MAN/CALENDAR_INTEGRATION_MERMAID.md
- Mermaid diagrams showing flow
- Architecture diagrams
- Request/response flows
```

**Step 3: Create GitHub Issue**
```bash
gh issue create \
  --title "Add Microsoft Calendar Integration" \
  --body "See DEV_MAN/CALENDAR_INTEGRATION_APP_PLAN.md for details"
```

**Step 4: Implement and Document Progress**
- Update code files
- Update DEV_MAN/README.md with status
- Commit with clear messages
- Reference issue numbers in commits

### 8. Key Differences from Next.js Projects

**Python vs JavaScript**:
| Next.js Pattern | Python Pattern |
|----------------|----------------|
| `npm install` | `uv sync` |
| `package.json` | `pyproject.toml` |
| `npm run dev` | `uv run uvicorn main:app --reload` |
| `npm test` | `uv run pytest` |
| `.next/` build dir | No build step (interpreted) |
| `node_modules/` | `.venv/` |
| Express/Next routes | FastAPI routes |
| TypeScript types | Python type hints |

**Architecture Differences**:
- **No frontend** - Pure backend API
- **JSON database** - Not PostgreSQL/MongoDB (at least initially)
- **LangChain agents** - AI-powered data extraction
- **Playwright** - Browser automation for scraping
- **VAPI integration** - Voice AI webhook handling
- **Docker-first** - Container deployment to Render

### 9. Discover Success Patterns

**What Works Well**:

1. **Comprehensive Documentation** - Every feature has APP_PLAN + diagrams
2. **Clear Architecture** - ARCHITECTURE.md explains everything
3. **Issue Tracking** - GitHub issues tied to DEV_MAN plans
4. **Quick Deployment** - git push ‚Üí auto-deploy to Render
5. **Containerization** - Docker ensures consistency
6. **Database-First Design** - Fast cached responses prioritized

**Example Success Pattern from DEV_MAN/README.md**:
```markdown
| Component | Status | Notes |
|-----------|---------|-------|
| üê≥ **Docker Build** | ‚úÖ **Working** | mark0025/peterentalvapi:latest |
| ‚òÅÔ∏è **Render Deploy** | ‚úÖ **Working** | Auto-deploy configured |
| üìä **Database** | ‚úÖ **Working** | 4 rentals cached |
| üîå **API Endpoints** | ‚úÖ **Working** | All endpoints live |
```

### 10. Trace Issue Resolution Workflow

**Example: VAPI Webhook Issue**

1. **Problem Identified** - Documented in `DEV_MAN/BEHAVIOR_ANALYSIS.md`
   - Expected: Return 4 database rentals (<1s)
   - Actual: Return 11 DuckDuckGo results (5-10s)

2. **Root Cause Analysis** - Detailed in BEHAVIOR_ANALYSIS.md
   - Issue 1: Payload parsing gap
   - Issue 2: Database staleness override

3. **Solution Documented** - Exact fixes with line numbers
   ```python
   # Fix 1: Add VAPI nested payload parsing (main.py ~line 176)
   if not website:
       website = request.get('body', {}).get('properties', {}).get('website', {}).get('value', '')
   ```

4. **Implementation** - Code changes + tests
5. **Deployment** - Docker rebuild + push ‚Üí Render auto-deploy
6. **Verification** - Test both local and deployed

## Methodology Discovery Questions

When examining this project, ask:

1. What's documented in CLAUDE.md vs DEV_MAN/?
2. How are GitHub issues created and tracked?
3. What's the deployment pipeline (Docker ‚Üí Render)?
4. How does the JSON database work?
5. What's the VAPI webhook integration?
6. How are Python dependencies managed (uv)?
7. What's the scraping strategy (3-layer approach)?
8. How is documentation organized (APP_PLAN + ASKI + MERMAID)?

## Key Files to Examine

### In Project Root:
```
CLAUDE.md                    # Project instructions for Claude
main.py                      # FastAPI application
rental_database.py           # Database operations
rental_data.json             # Cached data
pyproject.toml               # Dependencies
Dockerfile                   # Container build
render.yaml                  # Deployment config
```

### In DEV_MAN/:
```
README.md                    # Documentation index + status
ARCHITECTURE.md              # System architecture
BEHAVIOR_ANALYSIS.md         # Issue analysis
DEPLOYMENT_PIPELINE.md       # Deployment docs
*_APP_PLAN.md                # Feature plans
*_ASKI.md                    # ASCII diagrams
*_MERMAID.md                 # Mermaid diagrams
```

### In src/:
```
src/vapi/api/vapi_router.py        # VAPI endpoints
src/vapi/functions/calendar_*.py   # VAPI functions
src/calendar/microsoft_*.py        # Calendar integration
```

## Success Indicators

**Look for evidence of**:
- ‚úÖ Comprehensive planning (APP_PLAN documents)
- ‚úÖ Visual documentation (ASKI + Mermaid)
- ‚úÖ Clear architecture (ARCHITECTURE.md)
- ‚úÖ Issue tracking (GitHub issues)
- ‚úÖ Version control (git commits with clear messages)
- ‚úÖ Deployment automation (Render auto-deploy)
- ‚úÖ Testing strategy (pytest + manual testing)
- ‚úÖ Documentation maintenance (DEV_MAN kept current)

## Usage Instructions for New Claude Agent

1. **Start**: Read this file
2. **Context**: Read `CLAUDE.md` for project overview
3. **Architecture**: Read `DEV_MAN/ARCHITECTURE.md`
4. **Status**: Read `DEV_MAN/README.md` for current state
5. **Issues**: Check `gh issue list` for open work
6. **History**: Review `git log` for recent changes
7. **Documentation**: Browse `DEV_MAN/` for feature plans
8. **Code**: Examine key files (main.py, rental_database.py)

## Quick Start Commands

```bash
# 1. Understand the project
cat CLAUDE.md
cat DEV_MAN/README.md

# 2. Check current status
git status
gh issue list
cat rental_data.json | head -20

# 3. Explore documentation
ls -la DEV_MAN/
cat DEV_MAN/ARCHITECTURE.md

# 4. Test the system
uv run python rental_database.py
curl http://localhost:8000/health

# 5. Deploy changes
git add .
git commit -m "Your change"
git push origin main
```

## Learning from Past Work

**Calendar Integration Example** (DEV_MAN/CALENDAR_INTEGRATION_APP_PLAN.md):
- 25KB detailed implementation plan
- Complete code examples
- OAuth flow documentation
- Testing strategy
- Deployment checklist
- Success criteria

**This shows the pattern**:
1. Comprehensive upfront planning
2. Detailed code examples in documentation
3. Multiple visualization formats
4. Clear success criteria
5. Deployment considerations built-in

## Next Steps After Discovery

1. Read `CLAUDE.md` completely
2. Review all files in `DEV_MAN/`
3. Check GitHub issues for context
4. Review recent git commits
5. Test the application locally
6. Understand the deployment pipeline
7. Identify any open issues or planned features
8. Continue the established patterns

---

**Remember**: This is a Python/FastAPI project, not Next.js. The methodology is the same, but the tools and patterns are different. Always check `CLAUDE.md` and `DEV_MAN/` first before making changes.
